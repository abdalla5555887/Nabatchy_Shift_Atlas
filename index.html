<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¨Ø·Ø´ÙŠØ§Øª - Nabatchy Pro</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }

        .container {
            width: 98%;
            background: white;
            padding: 15px;
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© */
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: auto; /* ÙŠØ³Ù…Ø­ Ø¨ØªÙ…Ø¯Ø¯ Ø§Ù„Ø®Ù„ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø­Ø³Ø¨ Ø§Ù„Ù†Øµ */
            margin-bottom: 5px;
        }

        th, td {
            border: 1px solid #000;
            text-align: center;
            padding: 4px 6px;
            font-size: 11px; 
            vertical-align: middle;
            color: #000;
            white-space: nowrap; /* ÙŠÙ…Ù†Ø¹ Ù†Ø²ÙˆÙ„ Ø§Ù„Ù†Øµ Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ */
        }

        th {
            background-color: #eee;
            font-weight: bold;
        }

        .shift-cell { cursor: pointer; transition: 0.2s; min-height: 25px; }
        .selected-cell { background-color: #fff9c4 !important; outline: 2px solid #fbc02d; font-weight: bold; }

        h1 {
            text-align: center;
            font-size: 18px;
            margin: 0 0 15px 0;
            text-decoration: underline;
            font-weight: bold;
        }

        /* Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯ */
        .codes-list { margin-top: 15px; font-size: 11px; font-weight: bold; }
        .code-row input { border: none; background: transparent; font-weight: bold; width: 100%; font-family: inherit; }
        
        .signatures-wrapper { display: flex; justify-content: space-between; margin-top: 20px; padding: 0 20px; font-weight: bold; }
        .sig-block { text-align: center; width: 250px; }
        .sig-block input { border: none; text-align: center; font-weight: bold; width: 100%; font-size: 12px; background: transparent; margin-top: 5px; }

        /* Ù„ÙˆØ­Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… (ØªØ®ØªÙÙŠ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©) */
        .controls-panel {
            margin-top: 20px;
            padding: 15px;
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 8px;
        }
        
        .worker-btn { padding: 4px 8px; margin: 2px; cursor: pointer; font-size: 12px; border: 1px solid #999; border-radius: 3px; background: #fff;}
        .worker-btn.active { background: #333; color: #fff; }

        .history-tag {
            display: inline-block;
            background: #e3f2fd;
            color: #007bff;
            padding: 5px 12px;
            margin: 5px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 11px;
            border: 1px solid #007bff;
        }

        /* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„Ø¶Ù…Ø§Ù† ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ø±Ø¶ÙŠØ© */
        @media print {
            .controls-panel, .setup-bar, .history-section, .no-print { display: none !important; }
            @page { size: A4 landscape; margin: 5mm; }
            body { padding: 0; margin: 0; background: white; }
            .container { box-shadow: none; width: 100%; padding: 0; }
            
            /* Ø¶ØºØ· Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ Ù„Ø¶Ù…Ø§Ù† Ø§Ø­ØªÙˆØ§Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø© */
            html { zoom: 82%; } 
            
            table { width: 100% !important; border: 1px solid #000 !important; }
            th, td { border: 1px solid #000 !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 id="tableTitle">Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠÙŠÙ† ÙˆØ§Ù„ÙÙ†ÙŠÙŠÙ† Ø¨Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù… Ø¹Ù† Ø´Ù‡Ø± ...</h1>

    <div class="setup-bar" style="text-align:center; padding:10px; background:#f8f9fa; margin-bottom:10px; border: 1px solid #ddd;">
        <label>Ø§Ù„Ø´Ù‡Ø±: </label>
        <select id="monthSelect" onchange="generateTable()">
            <option value="1">ÙŠÙ†Ø§ÙŠØ±</option><option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option><option value="3">Ù…Ø§Ø±Ø³</option>
            <option value="4">Ø£Ø¨Ø±ÙŠÙ„</option><option value="5">Ù…Ø§ÙŠÙˆ</option><option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
            <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option><option value="8">Ø£ØºØ³Ø·Ø³</option><option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
            <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option><option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option><option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
        </select>
        <label> Ø§Ù„Ø³Ù†Ø©: </label>
        <input type="number" id="yearSelect" value="2026" style="width:65px;" onchange="generateTable()">
        
        <button onclick="saveToHistory()" style="background:#28a745; color:white; border:none; padding:5px 15px; cursor:pointer; margin-right:10px; font-weight:bold;">ğŸ’¾ Ø­ÙØ¸ Ù†Ø³Ø®Ø©</button>
        <button onclick="window.print()" style="background:#007bff; color:white; border:none; padding:5px 15px; cursor:pointer; margin-right:10px; font-weight:bold;">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
    </div>

    <table id="mainTable">
        <thead>
            <tr>
                <th width="35">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                <th width="80">Ø§Ù„ÙŠÙˆÙ…</th>
                <th>8 ØµØ¨Ø§Ø­Ø§Ù‹ - 2 Ø¸Ù‡Ø±Ø§Ù‹</th>
                <th>2 Ø¸Ù‡Ø±Ø§Ù‹ - 8 Ù…Ø³Ø§Ø¡Ù‹</th>
                <th>8 Ù…Ø³Ø§Ø¡Ù‹ - 8 ØµØ¨Ø§Ø­Ø§Ù‹</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <div class="codes-list">
        <div class="code-row"><input type="text" value="Ø§Ù„Ø§Ø¡ Ø¹Ø¨Ø¯Ø§Ù„Ù†Ø¨ÙŠ  1111 - Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ø­Ù…Ø¯  2222 - Ø­Ø³Ø§Ù… Ø­Ø³Ù†  3333"></div>
    </div>

    <div class="signatures-wrapper">
        <div class="sig-block"><div>Ù…Ø³Ø¤ÙˆÙ„ Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù…</div><input type="text" value="Ø¯/ Ù…Ù‡Ø§ ÙØªÙˆØ­ ÙˆØ§Ù„ÙŠ"></div>
        <div class="sig-block"><div> Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰</div><input type="text" value="Ø¯/ Ù…Ø­Ù…Ø¯ ØµÙ„Ø§Ø­ Ù‚Ø§Ø³Ù…"></div>
    </div>

    <div class="controls-panel">
        <div style="display:flex; gap:15px; align-items:center; margin-bottom:10px; background:#fff; padding:8px; border-radius:5px; border:1px solid #ccc;">
            <strong style="color:#007bff;">ğŸ” ØªØ­Ø¯ÙŠØ¯ Ø³Ø±ÙŠØ¹:</strong>
            <label>ÙŠÙˆÙ…:</label> <input type="number" id="quickDay" min="1" max="31" style="width:45px; text-align:center;">
            <label>ÙØªØ±Ø©:</label>
            <select id="quickShift">
                <option value="2">Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©</option><option value="3">Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ©</option><option value="4">Ø§Ù„Ù„ÙŠÙ„ÙŠØ©</option>
            </select>
            <button onclick="manualSelect()" style="background:#007bff; color:white; border:none; padding:4px 12px; cursor:pointer; border-radius:3px;">ØªØ­Ø¯ÙŠØ¯ ÙˆØªØ¸Ù„ÙŠÙ„</button>
        </div>

        <div id="palette" style="margin-bottom:10px;"></div>
        
        <div style="border-top:1px solid #ccc; padding-top:10px;">
            <input type="text" id="manualInput" placeholder="Ø§Ø³Ù… Ø¥Ø¶Ø§ÙÙŠ ÙŠØ¯ÙˆÙŠ..." style="padding:6px; width: 250px;">
            <button onclick="applyToCell()" style="background: green; color: white; border: none; padding: 6px 20px; font-weight: bold; cursor:pointer;">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø®Ù„ÙŠØ©</button>
            <button onclick="clearCell()" style="background: red; color: white; border: none; padding: 6px 15px; cursor:pointer;">Ù…Ø³Ø­</button>
        </div>

        <div class="history-section" style="margin-top:15px; border-top:1px dashed #999; padding-top:10px;">
            <strong>ğŸ“š Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</strong> <div id="historyList"></div>
        </div>
    </div>
</div>

<script>
    const workers = ["Ø®Ø§Ù„Ø¯ Ù‚Ø§Ø³Ù…", "Ù†Ø±Ù…ÙŠÙ† Ø·Ø§Ø±Ù‚", "Ø¬ÙŠÙ‡Ø§Ù† Ù†ØµØ±", "Ø¨Ø³Ù…Ø© Ù…Ø­Ù…Ø¯", "Ø§Ù„Ø§Ø¡ Ø¹Ø¨Ø¯ Ø§Ù„Ù†Ø¨ÙŠ", "Ø§Ù„Ø§Ø¡ Ù‚Ø§Ø³Ù…", "Ù…Ù‡Ø§ ÙˆØ§Ù„ÙŠ", "Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ø­Ù…Ø¯", "Ø§Ø³Ù…Ø§Ø¹ÙŠÙ„ Ø§Ù„Ø¹Ù…Ø§ÙˆÙŠ", "Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯", "Ø­Ø³Ø§Ù… Ø­Ø³Ù†", "ÙˆÙØ§Ø¡ Ø§Ù„Ù†Ù…Ø±", "Ø§Ø­Ù…Ø¯ Ø§Ù„Ø­Ø³ÙŠÙ†ÙŠ"];
    let selectedNames = [], activeCell = null;

    function init() {
        const p = document.getElementById('palette');
        workers.forEach(name => {
            const btn = document.createElement('button');
            btn.className = 'worker-btn';
            btn.textContent = name;
            btn.onclick = () => {
                if (selectedNames.includes(name)) { selectedNames = selectedNames.filter(n => n !== name); btn.classList.remove('active'); }
                else { selectedNames.push(name); btn.classList.add('active'); }
            };
            p.appendChild(btn);
        });
        document.getElementById('monthSelect').value = new Date().getMonth() + 1;
        generateTable();
        refreshHistoryUI();
    }

    function generateTable() {
        const month = parseInt(document.getElementById('monthSelect').value);
        const year = parseInt(document.getElementById('yearSelect').value);
        const tbody = document.getElementById('tableBody');
        const monthText = document.getElementById('monthSelect').options[month-1].text;
        document.getElementById('tableTitle').textContent = `Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠÙŠÙ† ÙˆØ§Ù„ÙÙ†ÙŠÙŠÙ† Ø¨Ø¨Ù†Ùƒ Ø§Ù„Ø¯Ù… Ø¹Ù† Ø´Ù‡Ø± ${monthText} ${year}`;
        tbody.innerHTML = '';
        const daysInMonth = new Date(year, month, 0).getDate();
        const arabicDays = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];
        for (let d = 1; d <= daysInMonth; d++) {
            const dateObj = new Date(year, month - 1, d);
            const row = document.createElement('tr');
            if (dateObj.getDay() === 5) row.style.backgroundColor = "#f2f2f2"; 
            row.innerHTML = `<td>${d}</td><td style="font-weight:bold;">${arabicDays[dateObj.getDay()]}</td><td class="shift-cell" onclick="selectCell(this)"></td><td class="shift-cell" onclick="selectCell(this)"></td><td class="shift-cell" onclick="selectCell(this)"></td>`;
            tbody.appendChild(row);
        }
    }

    function selectCell(cell) { 
        if (activeCell) activeCell.classList.remove('selected-cell'); 
        activeCell = cell; 
        cell.classList.add('selected-cell'); 
    }

    function manualSelect() {
        const day = parseInt(document.getElementById('quickDay').value);
        const shift = parseInt(document.getElementById('quickShift').value);
        const tbody = document.getElementById('tableBody');
        if (day >= 1 && day <= tbody.rows.length) {
            selectCell(tbody.rows[day-1].cells[shift]);
            tbody.rows[day-1].cells[shift].scrollIntoView({behavior: "smooth", block: "center"});
        }
    }

    function applyToCell() {
        if (!activeCell) return alert("Ø§Ø®ØªØ± Ø®Ù„ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹");
        let names = [...selectedNames, document.getElementById('manualInput').value.trim()].filter(x => x);
        activeCell.textContent = names.join(' - ');
        selectedNames = [];
        document.querySelectorAll('.worker-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('manualInput').value = '';
        activeCell.classList.remove('selected-cell'); activeCell = null;
    }

    function clearCell() { if (activeCell) activeCell.textContent = ''; }

    function saveToHistory() {
        const rows = document.getElementById('tableBody').rows;
        let data = [];
        for (let r of rows) data.push([r.cells[2].textContent, r.cells[3].textContent, r.cells[4].textContent]);
        let history = JSON.parse(localStorage.getItem('nabatchy_atlas_v3') || '[]');
        history.unshift({ time: new Date().toLocaleString('ar-EG'), data, month: document.getElementById('monthSelect').value });
        if (history.length > 5) history.pop();
        localStorage.setItem('nabatchy_atlas_v3', JSON.stringify(history));
        refreshHistoryUI();
        alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø¬Ø¹");
    }

    function refreshHistoryUI() {
        const list = document.getElementById('historyList');
        const history = JSON.parse(localStorage.getItem('nabatchy_atlas_v3') || '[]');
        list.innerHTML = history.length ? '' : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø³Ø®';
        history.forEach((item, idx) => {
            const span = document.createElement('span'); span.className = 'history-tag';
            span.textContent = item.time;
            span.onclick = () => {
                const tbody = document.getElementById('tableBody');
                item.data.forEach((r, i) => { if(tbody.rows[i]) { tbody.rows[i].cells[2].textContent = r[0]; tbody.rows[i].cells[3].textContent = r[1]; tbody.rows[i].cells[4].textContent = r[2]; } });
            };
            list.appendChild(span);
        });
    }

    window.onload = init;
</script>
</body>
</html>
